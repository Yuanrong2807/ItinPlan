<template name="planner">

	{{#if haveTrip}}
	<div class="container-fluid bodyWithPaddingTop">

		<!-- Alert -->
		{{#if isNewlyCreated}}
			<div class="alert alert-success alert-dismissible fade show" role="alert" id="newTripAlert">
				<h4 class="alert-heading">Welcome to your new trip itinerary!</h4>
				<p>Hi there! Start planning your future vacation.</p>
				<button type="button" class="close" data-dismiss="alert" aria-label="Close">
						<span aria-hidden="true">&times;</span>
					</button>
				<hr>
				<p class="mb-0">* Non registered users are unable to save their trips on the server! *</p>
			</div>
		{{/if}}

		<!-- Trip Name -->
		<h2 class="text-center">My Trip</h2>

		<!-- Control Panel for trip -->
		<div class="row p-3">
			<div class="col">
				<div class="card">
					<div class="card-body m-3">
						<!-- For members, allow save -->
						<button class="btn btn-primary btn-openSettings float-right" data-toggle="modal" data-target="#settingsModal">Edit settings</button>
						<!-- Trip statistics -->
						<h5 class="card-title">Trip name: {{tripName}}</h5>
						<h5 class="card-title">Country of interest: {{tripCountry}}</h5>
						<h5 class="card-title">Start Date: {{tripStartDate}}</h5>
						<h5 class="card-title">Days: {{tripDays.length}}</h5>
						<hr>
						{{#if checkLoginAndData}}
							<button class="btn btn-success btn-saveTrip float-right">Save Trip</button>
						{{/if}}
					</div>
				</div>
			</div>
		</div>
		<div class="w-100"></div>
	</div>

	<!--ensure trip stored in local storage constantly-->
	{{localStorageTrip}}

	<!-- trip planner itself -->
	<div class="container-fluid planner">

		<!--for each day in tripdays, create a daytemplate-->
		{{# each day in tripDays}}
			{{> dayTemplate dayIndex=@index day=day trip=reactiveTrip}}
		{{/each}}

		<!-- new day button -->
		<div class="row align-items-center p-3">
			<div class="btn btn-danger btn-addDay">Add Day</div>
		</div>
		<div class="w-100"></div>

	</div>
	{{else}}
		<!--loading spinner thingy-->
		<div class="container d-flex justify-content-center pt-5 mt-5">
			<div id="html-spinner"></div>
		</div>
	{{/if}}

	<!--this is for the control panel editing stuff-->
	{{> settingsModalTemplate trip=reactiveTrip}}

	<!--modal for opening location @yuanrong javascript must be in planner template-->
	<div class="modal fade" id="locationModal" tabindex="-1" role="dialog" aria-labelledby="modal display" aria-hidden="true">
		<div class="modal-dialog modal-dialog-centered modal-xl" role="document">
			<div class="modal-content">
			<div class="modal-header">
				<h5 class="modal-title">Select Location:</h5>
				<button type="button" class="close" data-dismiss="modal" aria-label="Close">
				<span aria-hidden="true">&times;</span>
				</button>
			</div>
      <div class="modal-body">
          <form>
              <div class="form-row align-items-center">
                  <div class="col-auto">
                      <input type="text" class="form-control" id="recipient-name">
                  </div>
                  <div class="col-auto">
                      <button type="button" class="btn btn-secondary btn-searchLoc">Search</button>
                  </div>
              </div>

          </form>
          <div class="map-container">
              {{> googleMap name="locMap" options=locationMap}}
          </div>
      </div>
			<div class="modal-footer">
				<button type="button" class="btn btn-secondary btn-saveLoc" data-dismiss="modal">Save</button>
			</div>
			</div>
		</div>
	</div>
</template>

<!--setting template-->
<template name="settingsModalTemplate">
	<div class="modal fade" id="settingsModal" tabindex="-1" role="dialog" aria-labelledby="modal display" aria-hidden="true">
		<div class="modal-dialog" role="document">
			<div class="modal-content">
				<div class="modal-header">
					<h5 class="modal-title" id="exampleModalLabel">My Trip settings:</h5>
					<button type="button" class="close" data-dismiss="modal" aria-label="Close">
					<span aria-hidden="true">&times;</span>
					</button>
				</div>
				<div class="modal-body">
					<div class="container pr-1 pl-1">
						<form>
							<div class="form-row p-1">
								<div class="form-group col">
									<label for="country">Trip name:</label>
									<input class="form-control" id="tripName"/>
									<div class="invalid-feedback">
										Invalid trip name.
									</div>
								</div>
							</div>
							
							<div class="form-row p-1">
								<div class="form-group col">
									<label for="country">Country:</label>
									<select class="form-control" id="country">
										<option value="Custom">Custom</option>
										{{#each country in countryDropDown}}
											<option value={{country}} >{{country}}</option>
											<!-- ensures the select option is the trip option -->
											{{setSelected}}
										{{/each}}
									</select>
								</div>
							</div>

							<div class="form-row p-1 align-items-end">
								<div class="form-group col">
									<label for="dateDay">Start Date:</label>
									<select class="form-control" id="dateDay" placeholder="Day">
										{{#each day in daysDropDown}}
											<option>{{day}}</option>
										{{/each}}
									</select>
								</div>

								<div class="form-group col">
									<select class="form-control" id="dateMonth" placeholder="Month">
										{{#each month in monthsDropDown}}
											<option>{{month}}</option>
										{{/each}}
									</select>
								</div>

								<div class="form-group col">
									<select class="form-control" id="dateYear" placeholder="Year">
										{{#each year in yearsDropDown}}
											<option>{{year}}</option>
										{{/each}}
									</select>
								</div>
							</div>

							<div class="form-row p-1">
								<div class="col">
									<label for="dayNumbers">Number of days:</label>
									<input type="number" class="form-control" id="dayNumbers" min="1" max="365"/>
									<div class="invalid-feedback">
										Too many days. Please keep it below 365 :)
									</div>
								</div>
							</div>

						</form>
					</div>
				</div>

				<div class="modal-footer">
					
					<button type="button" class="btn btn-secondary btn-saveSettings">Save</button>
				</div>
			</div>
		</div>
	</div>
</template>

<!-- template for each row -->
<template name="dayTemplate">
    <div class="row align-items-center p-3">
        <!--for each day, there is a day button and locations within the day template.-->
        <div class="card border-primary m-1 mr-4 text-center" style="width: 8rem;">
            <div class="card-body">
                <p class="card-text mt-2">Day {{getDayNum dayIndex}}</p>
                <div class="btn btn-danger btn-dayRemoveDay mb-2">Delete</div>
            </div>
        </div>

        {{# each location in day}}
            {{> locationTemplate dayIndex=dayIndex locIndex=@index location=location trip=trip}}
        {{/each}}
        <div class="btn btn-danger btn-dayAddLoc ml-4">Add Location</div>
    </div>
    <div class="w-100"></div>
</template>

<!-- template for each location -->
<template name="locationTemplate">
    <div class="card border-primary m-1" style="width: 12rem;">
        <img class="card-img-top planner m-1 border border-dark">
        <div class="card-body">
            <h6 class="card-title">{{getLocName}}</h6>
            <p class="card-text"></p>

            <button class="btn btn-danger btn-deleteLoc float-left m-1">
                <span aria-hidden="true">&times;</span>
            </button>

            <button class="btn btn-success btn-selectLoc float-right m-1" data-toggle="modal"
                    data-target="#locationModal" data-location={{location}}>Select Location
            </button>
        </div>
    </div>
</template>
